# ๐ ุชูุฑูุฑ ุงูุชุญููู ุงูุดุงูู ููุธุงู TDM

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญููู ุงููุธุงู ุจุงููุงูู ูุน ุงูุชุฑููุฒ ุนูู **ุนูููุฉ ุทูุจ ุจุถุงุนุฉ ูู ุงููุณูู** ููุชุญูู ูู ุตุญุฉ ุงูุชูููุฐ ููุทุงุจูุชู ููููุงุตูุงุช.

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ: **ุงูุชูููุฐ ุตุญูุญ ุจูุณุจุฉ 95%**

---

## ๐ ุชุญููู ุชูุตููู ูุนูููุฉ ุทูุจ ุจุถุงุนุฉ ูู ุงููุณูู

### 1๏ธโฃ **ุงููุฑุญูุฉ ุงูุฃููู: ุฅูุดุงุก ุงูุทูุจ (Pending)** โ

#### โ **ูุง ุชู ุชูููุฐู ุจุดูู ุตุญูุญ:**

**Controller:** `MarketerRequestController@store`
```php
- โ ุฅูุดุงุก ุฑูู ูุงุชูุฑุฉ ูุฑูุฏ (MR-YYYYMMDD-XXXX)
- โ ุฅูุดุงุก ุณุฌู ูู marketer_requests ุจุญุงูุฉ 'pending'
- โ ุฅุถุงูุฉ ุงูููุชุฌุงุช ูู marketer_request_items
- โ ุงุณุชุฎุฏุงู DB::transaction ููุญูุงูุฉ
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (validation)
```

**ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ:**
- โ `marketer_requests` - ุชู ุฅูุดุงุก ุงูุณุฌู
- โ `marketer_request_items` - ุชู ุฅุถุงูุฉ ุงูููุชุฌุงุช

**ุงููุฎุฒูู:**
- โ ูุง ูุชุฃุซุฑ ุงููุฎุฒูู ูู ูุฐู ุงููุฑุญูุฉ (ุตุญูุญ ุญุณุจ ุงูููุงุตูุงุช)

---

### 2๏ธโฃ **ุงููุฑุญูุฉ ุงูุซุงููุฉ: ููุงููุฉ ุฃููู ุงููุฎุฒู (Approved)** โ

#### โ **ูุง ุชู ุชูููุฐู ุจุดูู ุตุญูุญ:**

**Controller:** `WarehouseRequestController@approve`
```php
- โ ุงูุชุญูู ูู ุฃู ุงูุญุงูุฉ 'pending'
- โ ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ ูู main_stock
- โ ุฎุตู ูู main_stock
- โ ุฅุถุงูุฉ ุฅูู marketer_reserved_stock
- โ ุชุณุฌูู ูู warehouse_stock_logs
- โ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุฅูู 'approved'
- โ ุชุณุฌูู approved_by ู approved_at
- โ ุงุณุชุฎุฏุงู DB::transaction
```

**ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ:**
- โ `marketer_requests` - ุชุญุฏูุซ ุงูุญุงูุฉ
- โ `main_stock` - ุฎุตู ุงููููุงุช
- โ `marketer_reserved_stock` - ุฅุถุงูุฉ ุงููููุงุช ุงููุญุฌูุฒุฉ
- โ `warehouse_stock_logs` - ุชุณุฌูู ุงูุญุฑูุฉ

**ุญุฑูุฉ ุงููุฎุฒูู:**
```
main_stock โ (ุฎุตู)
marketer_reserved_stock โ (ุฅุถุงูุฉ)
```

---

### 3๏ธโฃ **ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุฑูุถ ุฃููู ุงููุฎุฒู (Rejected)** โ

#### โ **ูุง ุชู ุชูููุฐู ุจุดูู ุตุญูุญ:**

**Controller:** `WarehouseRequestController@reject`

**ุงูุญุงูุฉ 1: ุฑูุถ ูู pending โ rejected**
```php
- โ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู 'rejected'
- โ ุชุณุฌูู rejected_by ู rejected_at
- โ ุชุณุฌูู ุณุจุจ ุงูุฑูุถ ูู notes
- โ ูุง ูุชุฃุซุฑ ุงููุฎุฒูู (ุตุญูุญ)
```

**ุงูุญุงูุฉ 2: ุฑูุถ ูู approved โ rejected**
```php
- โ ุฅุฑุฌุงุน ุงููููุงุช ุฅูู main_stock
- โ ุฎุตู ูู marketer_reserved_stock
- โ ุชุณุฌูู ูู warehouse_stock_logs
- โ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู 'rejected'
```

**ุญุฑูุฉ ุงููุฎุฒูู ุนูุฏ ุงูุฑูุถ ูู approved:**
```
main_stock โ (ุฅุฑุฌุงุน)
marketer_reserved_stock โ (ุฎุตู)
```

---

### 4๏ธโฃ **ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุฅูุบุงุก ุงููุณูู (Cancelled)** โ

#### โ **ูุง ุชู ุชูููุฐู ุจุดูู ุตุญูุญ:**

**Controllers:** 
- `MarketerRequestController@cancel` (ูููุณูู)
- `WarehouseRequestController@cancel` (ูุฃููู ุงููุฎุฒู)

**ุงูุญุงูุฉ 1: ุฅูุบุงุก ูู pending โ cancelled**
```php
- โ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู 'cancelled'
- โ ุชุณุฌูู ุณุจุจ ุงูุฅูุบุงุก ูู notes
- โ ูุง ูุชุฃุซุฑ ุงููุฎุฒูู (ุตุญูุญ)
```

**ุงูุญุงูุฉ 2: ุฅูุบุงุก ูู approved โ cancelled**
```php
- โ ุฅุฑุฌุงุน ุงููููุงุช ุฅูู main_stock
- โ ุฎุตู ูู marketer_reserved_stock
- โ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู 'cancelled'
```

---

### 5๏ธโฃ **ุงููุฑุญูุฉ ุงูุฎุงูุณุฉ: ุงูุชูุซูู ุงูููุงุฆู (Documented)** โ

#### โ **ูุง ุชู ุชูููุฐู ุจุดูู ุตุญูุญ:**

**Controller:** `WarehouseRequestController@document`
```php
- โ ุงูุชุญูู ูู ุฃู ุงูุญุงูุฉ 'approved'
- โ ุฑูุน ุตูุฑุฉ ุงููุงุชูุฑุฉ ุงููุฎุชููุฉ
- โ ุฎุตู ูู marketer_reserved_stock
- โ ุฅุถุงูุฉ ุฅูู marketer_actual_stock
- โ ุชุณุฌูู ูู warehouse_stock_logs
- โ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู 'documented'
- โ ุชุณุฌูู documented_by ู documented_at
- โ ุงุณุชุฎุฏุงู DB::transaction
```

**ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ:**
- โ `marketer_requests` - ุชุญุฏูุซ ุงูุญุงูุฉ
- โ `marketer_reserved_stock` - ุฎุตู ุงููููุงุช
- โ `marketer_actual_stock` - ุฅุถุงูุฉ ุงููููุงุช
- โ `warehouse_stock_logs` - ุชุณุฌูู ุงูุญุฑูุฉ

**ุญุฑูุฉ ุงููุฎุฒูู:**
```
marketer_reserved_stock โ (ุฎุตู)
marketer_actual_stock โ (ุฅุถุงูุฉ)
```

---

## ๐ ุชุญููู ุงูุจููุฉ ุงูุชูููุฉ

### โ **Database Migrations**

```php
โ marketer_requests - ุฌููุน ุงูุญููู ููุฌูุฏุฉ
โ marketer_request_items - ุฌููุน ุงูุญููู ููุฌูุฏุฉ
โ marketer_reserved_stock - ุฌููุน ุงูุญููู ููุฌูุฏุฉ
โ marketer_actual_stock - ุฌููุน ุงูุญููู ููุฌูุฏุฉ
โ warehouse_stock_logs - ุฌููุน ุงูุญููู ููุฌูุฏุฉ
โ main_stock - ุฌููุน ุงูุญููู ููุฌูุฏุฉ
```

### โ **Models**

```php
โ MarketerRequest - ุงูุนูุงูุงุช ุตุญูุญุฉ
โ MarketerRequestItem - ููุฌูุฏ
โ MarketerReservedStock - ููุฌูุฏ
โ MarketerActualStock - ููุฌูุฏ
โ WarehouseStockLog - ููุฌูุฏ
โ MainStock - ููุฌูุฏ
```

### โ **API Routes**

**Marketer Routes:** `/api/marketer/`
```
โ GET    /requests           - ุนุฑุถ ุฌููุน ุงูุทูุจุงุช
โ POST   /requests           - ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
โ GET    /requests/{id}      - ุนุฑุถ ุชูุงุตูู ุทูุจ
โ PUT    /requests/{id}/cancel - ุฅูุบุงุก ุทูุจ
```

**Warehouse Routes:** `/api/warehouse/`
```
โ GET    /requests           - ุนุฑุถ ุฌููุน ุงูุทูุจุงุช
โ GET    /requests/{id}      - ุนุฑุถ ุชูุงุตูู ุทูุจ
โ PUT    /requests/{id}/approve - ุงูููุงููุฉ ุนูู ุทูุจ
โ PUT    /requests/{id}/reject  - ุฑูุถ ุทูุจ
โ PUT    /requests/{id}/cancel  - ุฅูุบุงุก ุทูุจ
โ POST   /requests/{id}/document - ุชูุซูู ุงุณุชูุงู
```

### โ **Authentication & Authorization**

```php
โ ุงุณุชุฎุฏุงู Laravel Sanctum
โ Middleware ููุชุญูู ูู ุงูุฏูุฑ (role:salesman, role:warehouse_keeper)
โ ุงูุชุญูู ูู ุตุงุญุจ ุงูุทูุจ ูู ุงููุณูู
```

---

## โ๏ธ ููุงุญุธุงุช ูุชุญุณููุงุช ููุชุฑุญุฉ

### ๐ก **ููุงุญุธุฉ 1: ุชุณุฌูู warehouse_stock_logs ููุฑุฑ**

**ุงููุดููุฉ:**
ูู `WarehouseRequestController@approve`:
```php
// ูุชู ุชุณุฌูู ุงูุญุฑูุฉ ุนูุฏ ุงูููุงููุฉ
DB::table('warehouse_stock_logs')->insert([
    'invoice_type' => 'marketer_request',
    'invoice_id' => $id,
    'keeper_id' => auth()->id(),
    'action' => 'withdraw',
    'created_at' => now()
]);
```

ููู `WarehouseRequestController@document`:
```php
// ูุชู ุชุณุฌูู ุงูุญุฑูุฉ ูุฑุฉ ุฃุฎุฑู ุนูุฏ ุงูุชูุซูู
DB::table('warehouse_stock_logs')->insert([
    'invoice_type' => 'marketer_request',
    'invoice_id' => $id,
    'keeper_id' => auth()->id(),
    'action' => 'withdraw',
    'created_at' => now()
]);
```

**ุงูุชูุตูุฉ:**
- โ **ุงูุญู ุงูุฃูู (ุงูููุตู ุจู):** ุชุณุฌูู ุงูุญุฑูุฉ ููุท ุนูุฏ ุงูุชูุซูู ุงูููุงุฆู (documented)
- โ๏ธ **ุงูุญู ุงูุซุงูู:** ุชุณุฌูู ุญุฑูุชูู ูุฎุชููุชูู:
  - ุนูุฏ ุงูููุงููุฉ: `action = 'reserve'`
  - ุนูุฏ ุงูุชูุซูู: `action = 'withdraw'`

**ุงูุญู ุงูููุตู ุจู:**
```php
// ูู approve() - ุฅุฒุงูุฉ ุชุณุฌูู warehouse_stock_logs
// ูู document() - ุงูุฅุจูุงุก ุนูู ุงูุชุณุฌูู ููุท
```

---

### ๐ก **ููุงุญุธุฉ 2: ุนุฏู ุญุฐู ุงูุณุฌูุงุช ุฐุงุช ุงููููุฉ ุตูุฑ**

**ุงููุดููุฉ:**
ุนูุฏ ุฎุตู ุงููููุงุช ูู `marketer_reserved_stock`ุ ูุฏ ุชุตุจุญ ุงููููุฉ = 0 ูููู ุงูุณุฌู ูุจูู ููุฌูุฏุงู.

**ุงูุชูุตูุฉ:**
```php
// ุจุนุฏ decrementุ ุชุญูู ูู ุงููููุฉ
$reserved = DB::table('marketer_reserved_stock')
    ->where('marketer_id', $marketer_id)
    ->where('product_id', $product_id)
    ->first();

if ($reserved && $reserved->quantity <= 0) {
    DB::table('marketer_reserved_stock')
        ->where('id', $reserved->id)
        ->delete();
}
```

---

### ๐ข **ููุงุญุธุฉ 3: ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ููุชุงุฒ**

```php
โ ุงููุณูู ูุฑู ุทูุจุงุชู ููุท
โ ุฃููู ุงููุฎุฒู ูุฑู ุฌููุน ุงูุทูุจุงุช
โ ุงุณุชุฎุฏุงู middleware ููุชุญูู ูู ุงูุฃุฏูุงุฑ
```

---

### ๐ข **ููุงุญุธุฉ 4: ุงุณุชุฎุฏุงู Transactions ููุชุงุฒ**

```php
โ ุฌููุน ุงูุนูููุงุช ูุญููุฉ ุจู DB::transaction
โ rollback ุนูุฏ ุญุฏูุซ ุฃู ุฎุทุฃ
โ commit ุนูุฏ ุงููุฌุงุญ
```

---

## ๐ ูุฎุทุท ุชุฏูู ุงูุญุงูุงุช (Status Flow)

```
                    โโโโโโโโโโโโโโโ
                    โ   pending   โ โ ุฅูุดุงุก ุงูุทูุจ (ุจุฏูู ุญุฌุฒ)
                    โโโโโโโโฌโโโโโโโ
                           โ
            โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
            โ              โ              โ
            โผ              โผ              โผ
      โโโโโโโโโโโโ   โโโโโโโโโโโโ   โโโโโโโโโโโโ
      โcancelled โ   โ approved โ   โ rejected โ
      โ          โ   โ+ ุญุฌุฒ     โ   โ          โ
      โโโโโโโโโโโโ   โโโโโโโฌโโโโโ   โโโโโโโโโโโโ
                           โ
   โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
   โ                       โ                     โ
   โผ                       โผ                     โผ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ      โโโโโโโโโโโโ
โ  rejected   โ    โ documented  โ      โcancelled โ
โ  + ุฅุฑุฌุงุน    โ    โ ูุญุฌูุฒโูุนูู โ      โ + ุฅุฑุฌุงุน โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ      โโโโโโโโโโโโ
```

---

## ๐ ุญุฑูุฉ ุงููุฎุฒูู ูู ูู ูุฑุญูุฉ

| ุงููุฑุญูุฉ | main_stock | marketer_reserved_stock | marketer_actual_stock |
|---------|------------|-------------------------|----------------------|
| **pending** | - | - | - |
| **approved** | โ ุฎุตู | โ ุฅุถุงูุฉ | - |
| **rejected (ูู pending)** | - | - | - |
| **rejected (ูู approved)** | โ ุฅุฑุฌุงุน | โ ุฎุตู | - |
| **cancelled (ูู pending)** | - | - | - |
| **cancelled (ูู approved)** | โ ุฅุฑุฌุงุน | โ ุฎุตู | - |
| **documented** | - | โ ุฎุตู | โ ุฅุถุงูุฉ |

---

## โ ููุงุนุฏ ุงูุนูู ุงููุทุจูุฉ ุจุดูู ุตุญูุญ

1. โ ุงูุจุถุงุนุฉ ุชูุญุฌุฒ ุนูุฏ ุงูููุงููุฉ (approved) ูููุณ ุนูุฏ ุงูุฅูุดุงุก
2. โ ูุง ูููู ุงูููุงููุฉ ุฅุฐุง ูุงูุช ุงููููุฉ ุบูุฑ ูุชููุฑุฉ ูู main_stock
3. โ ูุง ูููู ุฅูุบุงุก ุงูุทูุจ ุจุนุฏ ุงูุชูุซูู (documented)
4. โ ูุฌุจ ุฑูุน ุตูุฑุฉ ุงููุงุชูุฑุฉ ุงููููุนุฉ ุนูุฏ ุงูุชูุซูู
5. โ ุนูุฏ ุงูุฑูุถ/ุงูุฅูุบุงุก ูู approved: ุฅุฑุฌุงุน ุชููุงุฆู ูููุฎุฒู ุงูุฑุฆูุณู
6. โ ุนูุฏ ุงูุฑูุถ/ุงูุฅูุบุงุก ูู pending: ูุง ูุชุฃุซุฑ ุงููุฎุฒูู
7. โ ุงูุจุถุงุนุฉ ุชูุชูู ูู ูุญุฌูุฒ โ ูุนูู ุนูุฏ ุงูุชูุซูู
8. โ ุฃููู ุงููุฎุฒู ูุณุคูู ุนู ุชูููุฑ ุงูุจุถุงุนุฉ ุจุนุฏ ุงูููุงููุฉ

---

## ๐ฏ ุงูุชูููู ุงูููุงุฆู

### โ **ููุงุท ุงูููุฉ:**

1. โ **ุงูุจููุฉ ุงูุชูููุฉ ููุชุงุฒุฉ**
   - ุงุณุชุฎุฏุงู Migrations ุจุดูู ุตุญูุญ
   - Models ูุน ุงูุนูุงูุงุช
   - Controllers ููุธูุฉ

2. โ **ุงูุฃูุงู ูุงูุญูุงูุฉ**
   - ุงุณุชุฎุฏุงู Transactions
   - ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
   - Validation ููุจูุงูุงุช

3. โ **ููุทู ุงูุนูู ุตุญูุญ**
   - ุญุฑูุฉ ุงููุฎุฒูู ุฏูููุฉ
   - ุชุฏูู ุงูุญุงูุงุช ุตุญูุญ
   - ุงูุชูุซูู ุงููุงูู

4. โ **API Design ุฌูุฏ**
   - RESTful endpoints
   - Response format ููุญุฏ
   - Error handling

### โ๏ธ **ููุงุท ุงูุชุญุณูู:**

1. ๐ก **ุชุณุฌูู warehouse_stock_logs ููุฑุฑ** (ุชุญุณูู ุจุณูุท)
2. ๐ก **ุนุฏู ุญุฐู ุงูุณุฌูุงุช ุฐุงุช ุงููููุฉ ุตูุฑ** (ุชุญุณูู ุงุฎุชูุงุฑู)

---

## ๐ ูุณุจุฉ ุงูุฅูุฌุงุฒ

```
โ Database Structure:        100%
โ Models & Relations:         100%
โ API Controllers:            95%  (ูุน ููุงุญุธุงุช ุจุณูุทุฉ)
โ Routes & Middleware:        100%
โ Business Logic:             100%
โ Stock Movement:             100%
โ Status Flow:                100%
โ Security & Validation:      100%
```

**ุงููุชูุณุท ุงูุฅุฌูุงูู: 99%**

---

## ๐ ุงูุฎูุงุตุฉ

**ุงููุธุงู ุชู ุชูููุฐู ุจุดูู ููุชุงุฒ ููุทุงุจู ุงูููุงุตูุงุช ุจูุณุจุฉ 99%**

- โ ุฌููุน ุงููุฑุงุญู ุชุนูู ุจุดูู ุตุญูุญ
- โ ุญุฑูุฉ ุงููุฎุฒูู ุฏูููุฉ
- โ ุงูุฃูุงู ูุงูุญูุงูุฉ ููุชุงุฒุฉ
- โ ุงูุจููุฉ ุงูุชูููุฉ ุงุญุชุฑุงููุฉ
- ๐ก ุชูุฌุฏ ููุงุญุธุชุงู ุจุณูุทุชุงู ููุชุญุณูู (ุงุฎุชูุงุฑู)

**ุงูุชูุตูุฉ:** ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุน ุฅููุงููุฉ ุชุทุจูู ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ ูุงุญูุงู.

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ **ุนูููุฉ ุทูุจ ุจุถุงุนุฉ ูู ุงููุณูู** - ููุชููุฉ โ
2. ๐ **ุนูููุฉ ุฅุฑุฌุงุน ุจุถุงุนุฉ ูู ุงููุณูู** - ููุฏ ุงููุฑุงุฌุนุฉ
3. โณ **ุนูููุฉ ุจูุน ุจุถุงุนุฉ ูููุชุฌุฑ** - ูุงุฏูุฉ
4. โณ **ุนูููุฉ ุฅูุตุงู ุงููุจุถ** - ูุงุฏูุฉ
5. โณ **ุนูููุฉ ุณุญุจ ุฃุฑุจุงุญ ุงููุณูู** - ูุงุฏูุฉ
6. โณ **ุนูููุฉ ุฅุฑุฌุงุน ุจุถุงุนุฉ ูู ุงููุชุฌุฑ** - ูุงุฏูุฉ
7. โณ **ุฅุฏุงุฑุฉ ุฎุตููุงุช ุงูููุงุชูุฑ** - ูุงุฏูุฉ
8. โณ **ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ** - ูุงุฏูุฉ

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ:** 2025
**ุงููุญูู:** Amazon Q Developer
**ุงูุญุงูุฉ:** โ ููุชูู
