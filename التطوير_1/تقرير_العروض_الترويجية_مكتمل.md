# โ ุชูุฑูุฑ ุฅูุฌุงุฒ: ูุธุงู ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ **ูุธุงู ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ** ุจุดูู ูุงูู ูููุงู ููููุงุตูุงุช.
ุงููุธุงู: "ุงุดุชุฑู X ูุงุญุตู ุนูู Y ูุฌุงูุงู"

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1๏ธโฃ **Database** โ

#### ุงูุฌุฏูู: product_promotions
```
โ ููุฌูุฏ ูุณุจูุงู ูู ุงููุดุฑูุน
โ ุฌููุน ุงูุญููู ุงููุทููุจุฉ
โ ุงูุนูุงูุงุช ุตุญูุญุฉ
```

---

### 2๏ธโฃ **Model** โ

#### ProductPromotion.php
```php
โ ุฌููุน ุงูุญููู ูู fillable
โ Casts ููุญููู (date, boolean)
โ ุงูุนูุงูุฉ ูุน Product (product)
โ ุงูุนูุงูุฉ ูุน User (creator)
```

---

### 3๏ธโฃ **API Controller** โ

#### ProductPromotionController (ููุฅุฏุงุฑุฉ)
```php
โ index()   - ุนุฑุถ ุฌููุน ุงูุนุฑูุถ
โ store()   - ุฅูุดุงุก ุนุฑุถ ุฌุฏูุฏ
โ show()    - ุนุฑุถ ุชูุงุตูู ุนุฑุถ
โ toggleActive() - ุชูุนูู/ุชุนุทูู ุนุฑุถ
โ destroy() - ุญุฐู (soft delete) ุนุฑุถ
```

**ุงูููุฒุงุช:**
- โ Validation ุดุงูู
- โ ุงูุชุญูู ูู ุงูููุชุฌ ูุงููููุงุช
- โ ุงูุชุญูู ูู ุงูุชูุงุฑูุฎ
- โ Soft Delete (ุชุนุทูู ุจุฏูุงู ูู ุงูุญุฐู)

---

### 4๏ธโฃ **Resource** โ

#### ProductPromotionResource
```php
โ ุฌููุน ุงูุญููู ุงูุฃุณุงุณูุฉ
โ ุงุณู ุงูููุชุฌ (product_name)
โ ูุต ุงูุนุฑุถ (promotion_text)
โ Labels ูุชุฑุฌูุฉ (status_label)
โ ุชูุณูู ุงูุชูุงุฑูุฎ
โ ุงุณู ุงูููุดุฆ (creator_name)
```

---

### 5๏ธโฃ **Web Controller** โ

#### ProductPromotionController (Web)
```php
โ index()  - ุตูุญุฉ ุงููุงุฆูุฉ
โ create() - ุตูุญุฉ ุงูุฅูุดุงุก
โ ุชูููุฏ Token ููู API
```

---

### 6๏ธโฃ **API Routes** โ

#### Admin Routes: `/api/admin/`
```
โ GET    /promotions           - ุนุฑุถ ุฌููุน ุงูุนุฑูุถ
โ POST   /promotions           - ุฅูุดุงุก ุนุฑุถ ุฌุฏูุฏ
โ GET    /promotions/{id}      - ุนุฑุถ ุชูุงุตูู ุนุฑุถ
โ PUT    /promotions/{id}/toggle - ุชูุนูู/ุชุนุทูู
โ DELETE /promotions/{id}      - ุญุฐู (soft delete)
โ Middleware: auth:sanctum, role:admin
```

---

### 7๏ธโฃ **Web Routes** โ

#### Admin Routes: `/admin/`
```
โ GET /promotions         - ุตูุญุฉ ุงููุงุฆูุฉ
โ GET /promotions/create  - ุตูุญุฉ ุงูุฅูุดุงุก
โ Middleware: auth
```

---

### 8๏ธโฃ **Views** โ

#### index.blade.php
```
โ ุชุตููู ุงุญุชุฑุงูู
โ ุนุฑุถ ุงูุจุทุงูุงุช ูุน ุงูุชูุงุตูู
โ ุฒุฑ ุฅุถุงูุฉ ุนุฑุถ ุฌุฏูุฏ
โ ุชุจููุจุงุช (ููุนู/ูุนุทู)
โ ุฃุฒุฑุงุฑ ุชูุนูู/ุชุนุทูู
โ ุฒุฑ ุญุฐู
โ ุนุฑุถ ูุต ุงูุนุฑุถ (ุงุดุชุฑู X ูุงุญุตู ุนูู Y)
โ ุงุณุชุฏุนุงุก API
โ Dark Mode Support
```

#### create.blade.php
```
โ ูููุฐุฌ ุฅูุดุงุก ุนุฑุถ ุชุฑููุฌู
โ ุงุฎุชูุงุฑ ุงูููุชุฌ ูู ูุงุฆูุฉ
โ ุญูู ุงูุญุฏ ุงูุฃุฏูู ูููููุฉ
โ ุญูู ุงููููุฉ ุงููุฌุงููุฉ
โ ูุนุงููุฉ ูุจุงุดุฑุฉ ููุนุฑุถ
โ ุงุฎุชูุงุฑ ุงูุชูุงุฑูุฎ
โ Validation ูู ุงููุงุฌูุฉ
โ Dark Mode Support
```

---

### 9๏ธโฃ **Sidebar Integration** โ

```
โ ุฅุถุงูุฉ ุฑุงุจุท "ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ" ูู ูุณู ุงูุฅุฏุงุฑุฉ
โ ุฃููููุฉ ููุงุณุจุฉ (Tag)
โ Active state
โ ุจุฌุงูุจ "ุฎุตููุงุช ุงูููุงุชูุฑ"
```

---

### ๐ **ุชุทุจูู ุงูุนุฑุถ ุงูุชููุงุฆู** โ

#### ูู MarketerSalesController@store
```php
โ ุงูุจุญุซ ุนู ุนุฑุถ ุชุฑููุฌู ูุดุท
โ WHERE product_id = ุงูููุชุฌ
โ AND is_active = true
โ AND start_date <= today
โ AND end_date >= today
โ LIMIT 1

โ ุงูุชุญูู ูู ุงูุดุฑุท:
  - IF quantity >= min_quantity

โ ุญุณุงุจ ุงููููุฉ ุงููุฌุงููุฉ:
  - times = FLOOR(quantity / min_quantity)
  - free_quantity = times ร free_quantity

โ ุชุณุฌูู ูู sales_invoice_items:
  - quantity (ุงููุดุชุฑุงุฉ)
  - free_quantity (ุงููุฌุงููุฉ)
  - promotion_id
  - total_price (ุงููููุฉ ุงููุดุชุฑุงุฉ ููุท)

โ ุฎุตู ูู ุงููุฎุฒูู:
  - marketer_actual_stock -= (quantity + free_quantity)

โ ุฅุถุงูุฉ ูููุฎุฒูู ุงููุฑุญูู:
  - store_pending_stock += (quantity + free_quantity)

โ ุญุณุงุจ product_discount:
  - free_quantity ร unit_price
```

---

## ๐ ููููุฉ ุนูู ุงููุธุงู

### ุงููุฑุญูุฉ 1: ุฅูุดุงุก ุนุฑุถ ุชุฑููุฌู
**ุงููุงุนู:** ุงูุฅุฏุงุฑุฉ (Admin)

**ุงูุฎุทูุงุช:**
1. ุงูุฏุฎูู ุฅูู `/admin/promotions`
2. ุงูููุฑ ุนูู "ุฅุถุงูุฉ ุนุฑุถ ุชุฑููุฌู"
3. ุชุญุฏูุฏ:
   - ุงูููุชุฌ
   - ุงูุญุฏ ุงูุฃุฏูู ูููููุฉ ุงููุดุชุฑุงุฉ
   - ุงููููุฉ ุงููุฌุงููุฉ
   - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ
4. ูุนุงููุฉ ุงูุนุฑุถ: "ุงุดุชุฑู X ูุงุญุตู ุนูู Y ูุฌุงูุงู"
5. ุงูุญูุธ

**ุงููุชูุฌุฉ:**
- โ ุฅูุดุงุก ุณุฌู ูู product_promotions
- โ is_active = true
- โ ุงูุนุฑุถ ุฌุงูุฒ ููุชุทุจูู

---

### ุงููุฑุญูุฉ 2: ุชุทุจูู ุงูุนุฑุถ ุชููุงุฆูุงู
**ุงููุงุนู:** ุงููุธุงู (ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุจูุน)

**ุงูุฎุทูุงุช:**
1. ุงููุณูู ููุดุฆ ูุงุชูุฑุฉ ุจูุน
2. ููู ููุชุฌ ูู ุงููุงุชูุฑุฉ:
   - ุงูุจุญุซ ุนู ุนุฑุถ ูุดุท
   - ุงูุชุญูู ูู ุงูุดุฑุท (quantity >= min_quantity)
   - ุญุณุงุจ ุงููููุฉ ุงููุฌุงููุฉ
3. ุชุณุฌูู ูู ุงููุงุชูุฑุฉ:
   - quantity: ุงููููุฉ ุงููุดุชุฑุงุฉ
   - free_quantity: ุงููููุฉ ุงููุฌุงููุฉ
   - promotion_id: ูุนุฑู ุงูุนุฑุถ
4. ุฎุตู ูู ุงููุฎุฒูู:
   - ุงููููุฉ ุงููููุฉ (ูุดุชุฑุงุฉ + ูุฌุงููุฉ)
5. ุญุณุงุจ ุงูุณุนุฑ:
   - total_price = quantity ร unit_price
   - ุงููููุฉ ุงููุฌุงููุฉ ูุง ุชุญุณุจ ูู ุงูุณุนุฑ

**ุงููุชูุฌุฉ:**
- โ ุงูุนุฑุถ ูุทุจู ุชููุงุฆูุงู
- โ ูุง ูููู ูููุณูู ุชุนุฏููู
- โ ูุณุฌู ูู ุงููุงุชูุฑุฉ

---

### ุงููุฑุญูุฉ 3: ุฅุฏุงุฑุฉ ุงูุนุฑูุถ
**ุงููุงุนู:** ุงูุฅุฏุงุฑุฉ (Admin)

**ุงูุนูููุงุช ุงููุชุงุญุฉ:**

1. **ุชูุนูู/ุชุนุทูู:**
   - ุชุบููุฑ is_active
   - ุงูุนุฑูุถ ุงููุนุทูุฉ ูุง ุชุทุจู

2. **ุญุฐู (Soft Delete):**
   - ุชุนุทูู ููุงุฆู (is_active = false)
   - ูุง ูุชู ุงูุญุฐู ุงููุนูู
   - ููุญูุงุธ ุนูู ุงูุชุชุจุน ุงูุชุงุฑูุฎู

3. **โ ุงูุชุนุฏูู ููููุน:**
   - ูุง ูููู ุชุนุฏูู ุงูุดุฑูุท ุจุนุฏ ุงูุฅูุดุงุก
   - ุงูุจุฏูู: ุชุนุทูู ุงููุฏูู + ุฅูุดุงุก ุฌุฏูุฏ

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุดุฑุงุก 8 ูุทุน (ุงูุนุฑุถ: ุงุดุชุฑู 10 ูุงุญุตู ุนูู 2)
```
ุงููููุฉ ุงููุดุชุฑุงุฉ: 8
min_quantity: 10

ุงููุชูุฌุฉ:
  โ ูุง ูุญูู ุงูุดุฑุท (8 < 10)
  quantity = 8
  free_quantity = 0
  promotion_id = NULL
  total_price = 8 ร unit_price
```

### ูุซุงู 2: ุดุฑุงุก 15 ูุทุนุฉ (ุงูุนุฑุถ: ุงุดุชุฑู 10 ูุงุญุตู ุนูู 2)
```
ุงููููุฉ ุงููุดุชุฑุงุฉ: 15
min_quantity: 10
free_quantity: 2

ุงูุญุณุงุจ:
  times = FLOOR(15 / 10) = 1
  free_quantity = 1 ร 2 = 2

ุงููุชูุฌุฉ:
  โ ูุญูู ุงูุดุฑุท
  quantity = 15
  free_quantity = 2
  promotion_id = ูุนุฑู_ุงูุนุฑุถ
  total_price = 15 ร unit_price
  ุงููููุฉ ุงููููุฉ = 17 (15 + 2)
```

### ูุซุงู 3: ุดุฑุงุก 30 ูุทุนุฉ (ุงูุนุฑุถ: ุงุดุชุฑู 10 ูุงุญุตู ุนูู 2)
```
ุงููููุฉ ุงููุดุชุฑุงุฉ: 30
min_quantity: 10
free_quantity: 2

ุงูุญุณุงุจ:
  times = FLOOR(30 / 10) = 3
  free_quantity = 3 ร 2 = 6

ุงููุชูุฌุฉ:
  โ ูุญูู ุงูุดุฑุท (3 ูุฑุงุช)
  quantity = 30
  free_quantity = 6
  promotion_id = ูุนุฑู_ุงูุนุฑุถ
  total_price = 30 ร unit_price
  ุงููููุฉ ุงููููุฉ = 36 (30 + 6)
```

---

## ๐ฏ ุงูููุงุนุฏ ุงููุทุจูุฉ

1. โ ุนุฑุถ ูุงุญุฏ ููุท ูุดุท ููู ููุชุฌ
2. โ ุงูุนุฑุถ ูุทุจู ููุท ุฅุฐุง quantity >= min_quantity
3. โ ุงููููุฉ ุงููุฌุงููุฉ ุชุฎุตู ูู ุงููุฎุฒูู
4. โ ุงููููุฉ ุงููุฌุงููุฉ ูุง ุชุญุณุจ ูู ุงูุณุนุฑ
5. โ ุงูุนุฑุถ ูุทุจู ุถูู ุงููุชุฑุฉ ุงูุฒูููุฉ ููุท
6. โ ุงูุนุฑูุถ ุงููุนุทูุฉ ูุง ุชุทุจู
7. โ ูููู ุชุทุจูู ุงูุนุฑุถ ุนุฏุฉ ูุฑุงุช ูู ููุณ ุงููุงุชูุฑุฉ
8. โ โ ููููุน ุชุนุฏูู ุงูุดุฑูุท ุจุนุฏ ุงูุฅูุดุงุก
9. โ Soft Delete ููุญูุงุธ ุนูู ุงูุชุชุจุน

---

## ๐ ูุณุจุฉ ุงูุฅูุฌุงุฒ

```
โ Database:              100% (ููุฌูุฏ ูุณุจูุงู)
โ Model:                 100%
โ API Controller:        100%
โ Web Controller:        100%
โ API Routes:            100%
โ Web Routes:            100%
โ Resource:              100%
โ Views:                 100%
โ Sidebar Integration:   100%
โ Auto Apply Logic:      100% (ููุฌูุฏ ูุณุจูุงู)
```

**ุงููุชูุณุท ุงูุฅุฌูุงูู: 100%**

---

## ๐ ุงูุฎูุงุตุฉ

**ูุธุงู ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ ููููุฐ ุจุงููุงูู 100%** โ

**ุงูููุฒุงุช:**
- โ ุฅูุดุงุก ุนุฑูุถ ุชุฑููุฌูุฉ ูุชุนุฏุฏุฉ
- โ ูุธุงู "ุงุดุชุฑู X ูุงุญุตู ุนูู Y ูุฌุงูุงู"
- โ ุชุทุจูู ุชููุงุฆู ุนูุฏ ุฅูุดุงุก ุงููุงุชูุฑุฉ
- โ ูุนุงููุฉ ูุจุงุดุฑุฉ ููุนุฑุถ
- โ ุชูุนูู/ุชุนุทูู ุงูุนุฑูุถ
- โ Soft Delete
- โ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงุญุชุฑุงููุฉ
- โ Dark Mode Support
- โ API ูุงูู

**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู โ

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ

1. โ `app/Http/Controllers/Api/Admin/ProductPromotionController.php`
2. โ `app/Http/Controllers/Web/Admin/ProductPromotionController.php`
3. โ `app/Http/Resources/ProductPromotionResource.php`
4. โ `resources/views/admin/promotions/index.blade.php`
5. โ `resources/views/admin/promotions/create.blade.php`
6. โ ุชุญุฏูุซ `routes/api/admin.php`
7. โ ุชุญุฏูุซ `routes/web.php`
8. โ ุชุญุฏูุซ `resources/views/shared/sidebar.blade.php`

---

## ๐ ุงูุชูุงูู ูุน ุงููุธุงู

### ุงูุชุทุจูู ุงูุชููุงุฆู ูู MarketerSalesController
```php
โ ุงูุจุญุซ ุนู ุนุฑุถ ูุดุท ููููุชุฌ
โ ุงูุชุญูู ูู ุงูุดุฑุท (quantity >= min_quantity)
โ ุญุณุงุจ ุงููููุฉ ุงููุฌุงููุฉ
โ ุชุณุฌูู ูู sales_invoice_items
โ ุฎุตู ูู marketer_actual_stock
โ ุฅุถุงูุฉ ูู store_pending_stock
โ ุญุณุงุจ product_discount
```

### ุงูุชุฑุชูุจ ุงูุตุญูุญ ููุฎุตููุงุช
```
1. ุชุทุจูู ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ (ูููุฉ ูุฌุงููุฉ)
2. ุญุณุงุจ subtotal (ุงููููุฉ ุงููุดุชุฑุงุฉ ร ุงูุณุนุฑ)
3. ุญุณุงุจ product_discount (ูููุฉ ุงููููุฉ ุงููุฌุงููุฉ)
4. ุชุทุจูู invoice_discount (ุฎุตู ุงููุงุชูุฑุฉ)
5. ุญุณุงุจ total_amount (ุงููุจูุบ ุงูููุงุฆู)
```

---

**ุชุงุฑูุฎ ุงูุฅูุฌุงุฒ:** 2025
**ุงูุญุงูุฉ:** โ ููุชูู 100%
**ุฌุงูุฒ ููุงุฎุชุจุงุฑ:** ูุนู โ
