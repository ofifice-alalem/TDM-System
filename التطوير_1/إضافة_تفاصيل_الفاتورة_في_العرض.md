# إضافة تفاصيل الفاتورة في صفحة عرض الفاتورة

## التحديث المطبق

تم إضافة قسم **تفاصيل الفاتورة** في الجهة اليمنى (Sidebar) لصفحات عرض الفاتورة لجميع المستخدمين.

## الملفات المحدثة

### 1. صفحة المسوق
**الملف**: `resources/views/marketer/sales/show.blade.php`

### 2. صفحة أمين المخزن
**الملف**: `resources/views/warehouse/sales/show.blade.php`

### 3. صفحة الإدارة
**الملف**: `resources/views/admin/sales/show.blade.php`

## التفاصيل المعروضة

```
┌─────────────────────────────┐
│   تفاصيل الفاتورة          │
├─────────────────────────────┤
│ المجموع الفرعي    │ 1000 د │
│ خصم المنتجات      │  100 د │
│ خصم الفاتورة      │   50 د │
├─────────────────────────────┤
│ الإجمالي النهائي  │  850 د │
└─────────────────────────────┘
```

## البيانات المعروضة

1. **المجموع الفرعي** (`subtotal`): مجموع أسعار المنتجات قبل الخصومات
2. **خصم المنتجات** (`product_discount`): الخصم من العروض الترويجية (الكميات المجانية)
3. **خصم الفاتورة** (`invoice_discount_amount`): الخصم التلقائي حسب قيمة الفاتورة
4. **الإجمالي النهائي** (`total_amount`): المبلغ النهائي بعد جميع الخصومات

## التصميم

- **الموقع**: في الـ Sidebar الأيمن أسفل قسم الإجراءات
- **الألوان**:
  - المجموع الفرعي: رمادي
  - خصم المنتجات: أخضر (#22c55e)
  - خصم الفاتورة: برتقالي (#f59e0b)
  - الإجمالي النهائي: بنفسجي (primary color)
- **التنسيق**: كل سطر يحتوي على العنوان والقيمة بشكل واضح

## الكود المضاف

### HTML (في الـ Sidebar)
```html
<div style="background: rgba(139, 92, 246, 0.05); padding: 20px; border-radius: 16px; border: 1px solid rgba(139, 92, 246, 0.1); margin-top: 20px;">
    <div style="font-size: 13px; font-weight: 700; color: #64748b; margin-bottom: 16px;">تفاصيل الفاتورة</div>
    <div style="display: flex; flex-direction: column; gap: 12px;">
        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-light);">
            <span style="font-size: 13px; color: #64748b; font-weight: 600;">المجموع الفرعي</span>
            <span style="font-size: 14px; font-weight: 700; color: var(--text-light);" id="subtotalSidebar">-</span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-light);">
            <span style="font-size: 13px; color: #64748b; font-weight: 600;">خصم المنتجات</span>
            <span style="font-size: 14px; font-weight: 700; color: #22c55e;" id="productDiscountSidebar">-</span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-light);">
            <span style="font-size: 13px; color: #64748b; font-weight: 600;">خصم الفاتورة</span>
            <span style="font-size: 14px; font-weight: 700; color: #f59e0b;" id="invoiceDiscountSidebar">-</span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 12px 0;">
            <span style="font-size: 14px; color: var(--primary); font-weight: 700;">الإجمالي النهائي</span>
            <span style="font-size: 16px; font-weight: 800; color: var(--primary);" id="totalSidebar">-</span>
        </div>
    </div>
</div>
```

### JavaScript (في دالة displayDetails)
```javascript
// Update sidebar details
document.getElementById('subtotalSidebar').textContent = parseFloat(invoice.subtotal || 0).toFixed(2) + ' د';
document.getElementById('productDiscountSidebar').textContent = parseFloat(invoice.product_discount || 0).toFixed(2) + ' د';
document.getElementById('invoiceDiscountSidebar').textContent = parseFloat(invoice.invoice_discount_amount || 0).toFixed(2) + ' د';
document.getElementById('totalSidebar').textContent = parseFloat(invoice.total_amount).toFixed(2) + ' د';
```

## الفوائد

✅ **شفافية كاملة**: المستخدم يرى تفصيل كامل للفاتورة
✅ **سهولة الفهم**: عرض واضح للخصومات المطبقة
✅ **تصميم متناسق**: يتماشى مع تصميم الصفحة
✅ **معلومات دائمة**: القسم ثابت في الـ Sidebar أثناء التمرير

## مثال عملي

### فاتورة بقيمة 1000 دينار:
- **المجموع الفرعي**: 1000 د (سعر المنتجات)
- **خصم المنتجات**: 100 د (كميات مجانية من العروض)
- **خصم الفاتورة**: 50 د (خصم 5% على الفاتورة)
- **الإجمالي النهائي**: 850 د

### الحساب:
```
المجموع الفرعي = 1000 د
- خصم المنتجات = 100 د (لا يؤثر على المجموع الفرعي)
- خصم الفاتورة = 50 د (5% من 1000)
= الإجمالي النهائي = 850 د
```

## ملاحظات مهمة

1. **خصم المنتجات** يُحسب من قيمة الكميات المجانية (العروض الترويجية)
2. **خصم الفاتورة** يُطبق على المجموع الفرعي حسب الشرائح المحددة
3. جميع القيم تُعرض بدقة رقمين عشريين
4. القسم يظهر لجميع المستخدمين (مسوق، أمين مخزن، إدارة)

## الاختبار

1. افتح أي فاتورة: `/marketer/sales/{id}` أو `/warehouse/sales/{id}` أو `/admin/sales/{id}`
2. تحقق من ظهور قسم "تفاصيل الفاتورة" في الـ Sidebar
3. تأكد من صحة القيم المعروضة
4. تحقق من الألوان والتنسيق
