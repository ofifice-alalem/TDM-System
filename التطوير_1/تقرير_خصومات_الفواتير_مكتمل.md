# โ ุชูุฑูุฑ ุฅูุฌุงุฒ: ูุธุงู ุฅุฏุงุฑุฉ ุฎุตููุงุช ุงูููุงุชูุฑ ุงูุชููุงุฆูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ **ูุธุงู ุฅุฏุงุฑุฉ ุฎุตููุงุช ุงูููุงุชูุฑ ุงูุชููุงุฆูุฉ** ุจุดูู ูุงูู ูููุงู ููููุงุตูุงุช.

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1๏ธโฃ **Database** โ

#### ุงูุฌุฏูู: invoice_discount_tiers
```
โ ููุฌูุฏ ูุณุจูุงู ูู ุงููุดุฑูุน
โ ุฌููุน ุงูุญููู ุงููุทููุจุฉ
โ ุงูุนูุงูุงุช ุตุญูุญุฉ
```

---

### 2๏ธโฃ **Model** โ

#### InvoiceDiscountTier.php
```php
โ ุฌููุน ุงูุญููู ูู fillable
โ Casts ููุญููู (decimal, date, boolean)
โ ุงูุนูุงูุฉ ูุน User (creator)
```

---

### 3๏ธโฃ **API Controller** โ

#### InvoiceDiscountController (ููุฅุฏุงุฑุฉ)
```php
โ index()   - ุนุฑุถ ุฌููุน ููุงุนุฏ ุงูุฎุตู
โ store()   - ุฅูุดุงุก ูุงุนุฏุฉ ุฎุตู ุฌุฏูุฏุฉ
โ show()    - ุนุฑุถ ุชูุงุตูู ูุงุนุฏุฉ ุฎุตู
โ toggleActive() - ุชูุนูู/ุชุนุทูู ูุงุนุฏุฉ
โ destroy() - ุญุฐู (soft delete) ูุงุนุฏุฉ
```

**ุงูููุฒุงุช:**
- โ Validation ุดุงูู
- โ ุงูุชุญูู ูู ููุน ุงูุฎุตู (percentage/fixed)
- โ ุงูุชุญูู ูู ุงูุชูุงุฑูุฎ
- โ Soft Delete (ุชุนุทูู ุจุฏูุงู ูู ุงูุญุฐู)

---

### 4๏ธโฃ **Resource** โ

#### InvoiceDiscountResource
```php
โ ุฌููุน ุงูุญููู ุงูุฃุณุงุณูุฉ
โ Labels ูุชุฑุฌูุฉ (discount_type_label, status_label)
โ discount_display (ุนุฑุถ ููุญุฏ ููุฎุตู)
โ ุชูุณูู ุงูุชูุงุฑูุฎ
โ ุงุณู ุงูููุดุฆ (creator_name)
```

---

### 5๏ธโฃ **Web Controller** โ

#### InvoiceDiscountController (Web)
```php
โ index()  - ุตูุญุฉ ุงููุงุฆูุฉ
โ create() - ุตูุญุฉ ุงูุฅูุดุงุก
โ ุชูููุฏ Token ููู API
```

---

### 6๏ธโฃ **API Routes** โ

#### Admin Routes: `/api/admin/`
```
โ GET    /discounts           - ุนุฑุถ ุฌููุน ุงูููุงุนุฏ
โ POST   /discounts           - ุฅูุดุงุก ูุงุนุฏุฉ ุฌุฏูุฏุฉ
โ GET    /discounts/{id}      - ุนุฑุถ ุชูุงุตูู ูุงุนุฏุฉ
โ PUT    /discounts/{id}/toggle - ุชูุนูู/ุชุนุทูู
โ DELETE /discounts/{id}      - ุญุฐู (soft delete)
โ Middleware: auth:sanctum, role:admin
```

---

### 7๏ธโฃ **Web Routes** โ

#### Admin Routes: `/admin/`
```
โ GET /discounts         - ุตูุญุฉ ุงููุงุฆูุฉ
โ GET /discounts/create  - ุตูุญุฉ ุงูุฅูุดุงุก
โ Middleware: auth
```

---

### 8๏ธโฃ **Views** โ

#### index.blade.php
```
โ ุชุตููู ุงุญุชุฑุงูู
โ ุนุฑุถ ุงูุจุทุงูุงุช ูุน ุงูุชูุงุตูู
โ ุฒุฑ ุฅุถุงูุฉ ูุงุนุฏุฉ ุฌุฏูุฏุฉ
โ ุฃุฒุฑุงุฑ ุชูุนูู/ุชุนุทูู
โ ุฒุฑ ุญุฐู
โ ุงุณุชุฏุนุงุก API
โ Dark Mode Support
```

#### create.blade.php
```
โ ูููุฐุฌ ุฅูุดุงุก ูุงุนุฏุฉ ุฎุตู
โ ุงุฎุชูุงุฑ ููุน ุงูุฎุตู (percentage/fixed)
โ ุญููู ุฏููุงููููุฉ ุญุณุจ ุงูููุน
โ ุงุฎุชูุงุฑ ุงูุชูุงุฑูุฎ
โ Validation ูู ุงููุงุฌูุฉ
โ Dark Mode Support
```

---

### 9๏ธโฃ **Sidebar Integration** โ

```
โ ุฅุถุงูุฉ ุฑุงุจุท "ุฎุตููุงุช ุงูููุงุชูุฑ" ูู ูุณู ุงูุฅุฏุงุฑุฉ
โ ุฃููููุฉ ููุงุณุจุฉ
โ Active state
```

---

### ๐ **ุชุทุจูู ุงูุฎุตู ุงูุชููุงุฆู** โ

#### ูู MarketerSalesController@store
```php
โ ุงูุจุญุซ ุนู ูุงุนุฏุฉ ุฎุตู ููุงุณุจุฉ
โ WHERE min_amount <= subtotal
โ AND is_active = true
โ AND start_date <= today
โ AND end_date >= today
โ ORDER BY min_amount DESC
โ LIMIT 1

โ ุญุณุงุจ ุงูุฎุตู ุญุณุจ ุงูููุน:
  - percentage: subtotal ร (percentage / 100)
  - fixed: discount_amount

โ ุชุณุฌูู ูู sales_invoices:
  - invoice_discount_type
  - invoice_discount_value
  - invoice_discount_amount
  - total_amount (ุจุนุฏ ุงูุฎุตู)
```

---

## ๐ ููููุฉ ุนูู ุงููุธุงู

### ุงููุฑุญูุฉ 1: ุฅูุดุงุก ูุงุนุฏุฉ ุฎุตู
**ุงููุงุนู:** ุงูุฅุฏุงุฑุฉ (Admin)

**ุงูุฎุทูุงุช:**
1. ุงูุฏุฎูู ุฅูู `/admin/discounts`
2. ุงูููุฑ ุนูู "ุฅุถุงูุฉ ูุงุนุฏุฉ ุฎุตู"
3. ุชุญุฏูุฏ:
   - ุงูุญุฏ ุงูุฃุฏูู ูููุจูุบ
   - ููุน ุงูุฎุตู (ูุณุจุฉ/ุซุงุจุช)
   - ูููุฉ ุงูุฎุตู
   - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ
4. ุงูุญูุธ

**ุงููุชูุฌุฉ:**
- โ ุฅูุดุงุก ุณุฌู ูู invoice_discount_tiers
- โ is_active = true
- โ ุงููุงุนุฏุฉ ุฌุงูุฒุฉ ููุชุทุจูู

---

### ุงููุฑุญูุฉ 2: ุชุทุจูู ุงูุฎุตู ุชููุงุฆูุงู
**ุงููุงุนู:** ุงููุธุงู (ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุจูุน)

**ุงูุฎุทูุงุช:**
1. ุงููุณูู ููุดุฆ ูุงุชูุฑุฉ ุจูุน
2. ุงููุธุงู ูุญุณุจ subtotal
3. ุงูุจุญุซ ุนู ูุงุนุฏุฉ ุฎุตู ููุงุณุจุฉ:
   ```sql
   WHERE min_amount <= subtotal
   AND is_active = true
   AND start_date <= today
   AND end_date >= today
   ORDER BY min_amount DESC
   LIMIT 1
   ```
4. ุชุทุจูู ุงูุฎุตู:
   - ุฅุฐุง percentage: discount = subtotal ร (percentage / 100)
   - ุฅุฐุง fixed: discount = discount_amount
5. ุญุณุงุจ ุงููุจูุบ ุงูููุงุฆู:
   ```
   total_amount = subtotal - invoice_discount_amount
   ```

**ุงููุชูุฌุฉ:**
- โ ุงูุฎุตู ูุทุจู ุชููุงุฆูุงู
- โ ูุง ูููู ูููุณูู ุชุนุฏููู
- โ ูุณุฌู ูู ุงููุงุชูุฑุฉ

---

### ุงููุฑุญูุฉ 3: ุฅุฏุงุฑุฉ ุงูููุงุนุฏ
**ุงููุงุนู:** ุงูุฅุฏุงุฑุฉ (Admin)

**ุงูุนูููุงุช ุงููุชุงุญุฉ:**

1. **ุชูุนูู/ุชุนุทูู:**
   - ุชุบููุฑ is_active
   - ุงูููุงุนุฏ ุงููุนุทูุฉ ูุง ุชุทุจู

2. **ุญุฐู (Soft Delete):**
   - ุชุนุทูู ููุงุฆู (is_active = false)
   - ูุง ูุชู ุงูุญุฐู ุงููุนูู
   - ููุญูุงุธ ุนูู ุงูุชุชุจุน ุงูุชุงุฑูุฎู

3. **โ ุงูุชุนุฏูู ููููุน:**
   - ูุง ูููู ุชุนุฏูู ุงูููู ุจุนุฏ ุงูุฅูุดุงุก
   - ุงูุจุฏูู: ุชุนุทูู ุงููุฏููุฉ + ุฅูุดุงุก ุฌุฏูุฏุฉ

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ูุงุชูุฑุฉ 800 ุฑูุงู
```
ููุงุนุฏ ุงูุฎุตู:
  - min_amount: 1000, discount: 5%
  - min_amount: 5000, discount: 10%

ุงููุชูุฌุฉ:
  โ ูุง ุชูุฌุฏ ูุงุนุฏุฉ ุชูุทุจู (800 < 1000)
  invoice_discount_amount = 0
  total_amount = 800
```

### ูุซุงู 2: ูุงุชูุฑุฉ 3000 ุฑูุงู
```
ููุงุนุฏ ุงูุฎุตู:
  - min_amount: 1000, discount: 5%
  - min_amount: 5000, discount: 10%

ุงููุชูุฌุฉ:
  โ ุงููุงุนุฏุฉ ุงููุทุจูุฉ: 1000 โ 5%
  invoice_discount_amount = 3000 ร 0.05 = 150
  total_amount = 2850
```

### ูุซุงู 3: ูุงุชูุฑุฉ 7000 ุฑูุงู
```
ููุงุนุฏ ุงูุฎุตู:
  - min_amount: 1000, discount: 5%
  - min_amount: 5000, discount: 10%

ุงููุชูุฌุฉ:
  โ ุงููุงุนุฏุฉ ุงููุทุจูุฉ: 5000 โ 10%
  invoice_discount_amount = 7000 ร 0.10 = 700
  total_amount = 6300
```

---

## ๐ฏ ุงูููุงุนุฏ ุงููุทุจูุฉ

1. โ ูููู ูุฌูุฏ ุนุฏุฉ ููุงุนุฏ ูุดุทุฉ
2. โ ูุชู ุงุฎุชูุงุฑ ุงููุงุนุฏุฉ ุฐุงุช ุงูุญุฏ ุงูุฃุฏูู ุงูุฃุนูู
3. โ ุงูุฎุตู ูุทุจู ุถูู ุงููุชุฑุฉ ุงูุฒูููุฉ ููุท
4. โ ุงูููุงุนุฏ ุงููุนุทูุฉ ูุง ุชุทุจู
5. โ ุงูุฎุตู ุชููุงุฆู ููุง ูููู ูููุณูู ุชุนุฏููู
6. โ โ ููููุน ุชุนุฏูู ุงูููู ุจุนุฏ ุงูุฅูุดุงุก
7. โ Soft Delete ููุญูุงุธ ุนูู ุงูุชุชุจุน

---

## ๐ ูุณุจุฉ ุงูุฅูุฌุงุฒ

```
โ Database:              100% (ููุฌูุฏ ูุณุจูุงู)
โ Model:                 100%
โ API Controller:        100%
โ Web Controller:        100%
โ API Routes:            100%
โ Web Routes:            100%
โ Resource:              100%
โ Views:                 100%
โ Sidebar Integration:   100%
โ Auto Apply Logic:      100% (ููุฌูุฏ ูุณุจูุงู)
```

**ุงููุชูุณุท ุงูุฅุฌูุงูู: 100%**

---

## ๐ ุงูุฎูุงุตุฉ

**ูุธุงู ุฅุฏุงุฑุฉ ุฎุตููุงุช ุงูููุงุชูุฑ ููููุฐ ุจุงููุงูู 100%** โ

**ุงูููุฒุงุช:**
- โ ุฅูุดุงุก ููุงุนุฏ ุฎุตู ูุชุนุฏุฏุฉ
- โ ููุนูู ูู ุงูุฎุตู (ูุณุจุฉ/ุซุงุจุช)
- โ ุชุทุจูู ุชููุงุฆู ุนูุฏ ุฅูุดุงุก ุงููุงุชูุฑุฉ
- โ ุชูุนูู/ุชุนุทูู ุงูููุงุนุฏ
- โ Soft Delete
- โ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงุญุชุฑุงููุฉ
- โ Dark Mode Support
- โ API ูุงูู

**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู โ

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ

1. โ `app/Http/Controllers/Api/Admin/InvoiceDiscountController.php`
2. โ `app/Http/Controllers/Web/Admin/InvoiceDiscountController.php`
3. โ `app/Http/Resources/InvoiceDiscountResource.php`
4. โ `resources/views/admin/discounts/index.blade.php`
5. โ `resources/views/admin/discounts/create.blade.php`
6. โ ุชุญุฏูุซ `routes/api/admin.php`
7. โ ุชุญุฏูุซ `routes/web.php`
8. โ ุชุญุฏูุซ `resources/views/shared/sidebar.blade.php`

---

**ุชุงุฑูุฎ ุงูุฅูุฌุงุฒ:** 2025
**ุงูุญุงูุฉ:** โ ููุชูู 100%
**ุฌุงูุฒ ููุงุฎุชุจุงุฑ:** ูุนู โ
